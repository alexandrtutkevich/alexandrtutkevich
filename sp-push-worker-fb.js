"use strict";var sServerApi="https://pushdata.sendpulse.com:4434",source_pushpush="pushpush",pushPushUrl="https://click.pushpush.io/show.php";self.addEventListener("install",function(t){t.waitUntil(self.skipWaiting())}),self.addEventListener("push",function(t){var g=!1,p=!1,m=null;t.data&&((g=t.data.json()).message&&g.message.source===source_pushpush&&(p=!0,m=g.message.task_id_new),g.data&&g.data.source===source_pushpush&&(p=!0,m=g.data.task_id_new)),t.waitUntil(self.registration.pushManager.getSubscription().then(function(t){if(p&&m){var i={},e=m;return"string"==typeof e&&(e=JSON.parse(e)),fetch(pushPushUrl,{method:"post",body:JSON.stringify({task_info:e})}).then(function(t){return t.json()}).then(function(t){if(void 0===t){return self.registration.showNotification("Oops! We couldn't fetch the notification",{body:"Sorry, due to some error the notification that was sent couldn't be displayed.",tag:"notification-error"})}return i.body=t.body,i.icon=t.icon,i.data={},i.data.redirectUrl=t.link,i.image=t.image,self.registration.showNotification(t.title,i)}).catch(function(t){return self.registration.showNotification("Oops! We couldn't fetch the notification",{body:"Sorry, due to some error the notification that was sent couldn't be displayed.",tag:"notification-error"})})}if(!g){a="Oops! We couldn't fetch the notification",o="Sorry, due to some error the notification that was sent couldn't be displayed.",r="notification-error";return self.registration.showNotification(a,{body:o,tag:r})}if(!g.message){if(g.notification)var a=g.notification.title,o=g.notification.body,n=g.notification.icon;else{var a=void 0,o=void 0;n=void 0}if(void 0===a)a=g.data.title;if(void 0===o)o=g.data.body;if(void 0===n)n=g.data.icon;var r=g.collapse_key,s=g.data.url,d=g.data.subscription,c="true"==g.data.requireInteraction,f=parseInt(g.data.task_id),u=parseInt(g.data.user_id);i={body:o,icon:n,tag:r,data:{redirectUrl:s},requireInteraction:c};if(void 0!==g.data.buttons){if("string"==typeof g.data.buttons)var h=JSON.parse(g.data.buttons);else h=g.data.buttons;i.actions=h,i.data.buttons=h}void 0!==g.data.image&&(i.image=g.data.image);var l={action:"statisctic",subscriptionId:d,statisctic_action:"delivered",task_id:f,user_id:u};return void 0!==g.data.addData&&(l.addData=g.data.addData),fetch(sServerApi,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}).then(function(t){return self.registration.showNotification(a,i)}).catch(function(t){return self.registration.showNotification(a,i)})}self.registration.pushManager.getSubscription().then(function(t){var i=null,e=(i="subscriptionId"in t?t.subscriptionId:t.endpoint).split("/");i=e[e.length-1];var a=Base64.decode(g.message.title),o={body:Base64.decode(g.message.message),icon:g.message.icon,tag:g.message.tag,data:{redirectUrl:Base64.decode(g.message.url)},requireInteraction:!0};void 0!==g.message.buttons&&(o.actions=g.message.buttons,o.data.buttons=g.message.buttons),void 0!==g.message.image&&(o.image=g.message.image);var n={action:"statisctic",subscriptionId:i,statisctic_action:"delivered",task_id:g.message.task_id,user_id:g.message.user_id};return void 0!==g.message.addData&&(n.addData=g.message.addData),fetch(sServerApi,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(function(t){return self.registration.showNotification(a,o)}).catch(function(t){return self.registration.showNotification(a,o)})})}))}),self.addEventListener("notificationclick",function(t){var a=t.notification.data.redirectUrl;if(void 0!==t.action){var i=t.action;if(void 0!==t.notification.data.buttons)for(var e=0;e<t.notification.data.buttons.length;e++)t.notification.data.buttons[e].action==i&&(a=t.notification.data.buttons[e].url)}t.notification.close(),t.waitUntil(clients.matchAll({type:"window"}).then(function(t){for(var i=0;i<t.length;i++){var e=t[i];if("/"==e.url&&"focus"in e)return e.focus()}if(clients.openWindow)return clients.openWindow(a)}))});var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(t){var i,e,a,o,n,r,s,d="",c=0;for(t=Base64._utf8_encode(t);c<t.length;)o=(i=t.charCodeAt(c++))>>2,n=(3&i)<<4|(e=t.charCodeAt(c++))>>4,r=(15&e)<<2|(a=t.charCodeAt(c++))>>6,s=63&a,isNaN(e)?r=s=64:isNaN(a)&&(s=64),d=d+this._keyStr.charAt(o)+this._keyStr.charAt(n)+this._keyStr.charAt(r)+this._keyStr.charAt(s);return d},decode:function(t){var i,e,a,o,n,r,s="",d=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");d<t.length;)i=this._keyStr.indexOf(t.charAt(d++))<<2|(o=this._keyStr.indexOf(t.charAt(d++)))>>4,e=(15&o)<<4|(n=this._keyStr.indexOf(t.charAt(d++)))>>2,a=(3&n)<<6|(r=this._keyStr.indexOf(t.charAt(d++))),s+=String.fromCharCode(i),64!=n&&(s+=String.fromCharCode(e)),64!=r&&(s+=String.fromCharCode(a));return s=Base64._utf8_decode(s)},_utf8_encode:function(t){t=t.replace(/\r\n/g,"\n");for(var i="",e=0;e<t.length;e++){var a=t.charCodeAt(e);a<128?i+=String.fromCharCode(a):(127<a&&a<2048?i+=String.fromCharCode(a>>6|192):(i+=String.fromCharCode(a>>12|224),i+=String.fromCharCode(a>>6&63|128)),i+=String.fromCharCode(63&a|128))}return i},_utf8_decode:function(t){for(var i="",e=0,a=0,o=0,n=0;e<t.length;)(a=t.charCodeAt(e))<128?(i+=String.fromCharCode(a),e++):191<a&&a<224?(o=t.charCodeAt(e+1),i+=String.fromCharCode((31&a)<<6|63&o),e+=2):(o=t.charCodeAt(e+1),n=t.charCodeAt(e+2),i+=String.fromCharCode((15&a)<<12|(63&o)<<6|63&n),e+=3);return i}};